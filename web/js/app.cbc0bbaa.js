(function(){var e={7044:function(e,t,i){"use strict";var s=i(7768),o=i(192),a=i.n(o),l=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[e.showGuideline?t("div",{staticClass:"guideline",style:{zIndex:1e3,position:"absolute",top:`${e.guidelineY}px`,left:"0px",width:"100%",height:"1px",backgroundColor:e.guideLineColor}}):e._e(),e.showGuideline?t("div",{staticClass:"guideline",style:{zIndex:1e3,position:"absolute",top:"0",left:`${e.guidelineX}px`,width:"1px",height:"100%",backgroundColor:e.guideLineColor}}):e._e(),t("el-tooltip",{staticClass:"fixed-button",attrs:{placement:"top"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" usage:"),t("br"),t("br"),e._v(" basic:"),t("br"),t("br"),e._v(" 1. hold ctrl key to drag the image"),t("br"),t("br"),e._v(" 2. hold ctrl key and mouse scroll to zoom in / out"),t("br"),t("br"),t("br"),e._v(" shortcuts:"),t("br"),t("br"),e._v(" 1. when a label box has focus, press number key (1,2,3...) to change"),t("br"),e._v("     its label to corresponding label in the label list"),t("br"),t("br"),e._v(" 2. when a label box has focus, press del to remove it"),t("br"),t("br"),e._v(" 3. press left / right arrow key to switch to next / previous image"),t("br")]),t("i",{staticClass:"el-icon-info",staticStyle:{"font-size":"36px"}})]),t("el-container",{ref:"parentContainer",staticStyle:{height:"100%",border:"1px solid #eee"}},[e.isFullScreen?e._e():t("el-aside",{staticStyle:{"background-color":"rgb(238, 241, 246)"},attrs:{width:"200px"}},[t("image-slider")],1),t("el-main",{staticStyle:{overflow:"hidden"}},[e.isFullScreen?e._e():t("div",{staticClass:"btn-area",staticStyle:{"justify-content":"space-between"}},[t("div",{staticStyle:{"margin-left":"74px","text-align":"left"}},[t("div",[e._v("total images："+e._s(e.imgs.length))]),t("div",[e._v("labelled images: "+e._s(e.markedImgs))]),t("div",{staticStyle:{display:"inline-block"}},[e._v("labels in current image:  ")]),e._l(Object.keys(e.currentTags),(function(i,s){return t("div",{key:i,staticStyle:{display:"inline-block"}},[t("div",{staticStyle:{display:"inline-block"},style:{background:e.validTags[i].color}},[e._v(" ")]),e._v(" "+e._s(e.currentTags[i])+e._s(s<Object.keys(e.currentTags).length-1?",":"")+"   ")])})),t("div",{staticStyle:{display:"block"}}),t("el-checkbox",{model:{value:e.isShowName,callback:function(t){e.isShowName=t},expression:"isShowName"}},[e._v("show label name")])],2),t("el-button",{staticStyle:{"margin-right":"74px"},attrs:{type:"primary"},on:{click:e.generateDataSet}},[e._v(" generate dataset ")])],1),t("div",{ref:"maskBox",style:{width:e.wrapperWidth+"px",height:e.wrapperHeight+"px"},attrs:{id:"image-wrapper"},on:{mousemove:e.drawGuideline}},[t("img",{ref:"img",class:{dragging:e.isDragging},style:{width:e.imgW+"px",height:e.imgH+"px",top:e.top+"px",left:e.left+"px",transform:`scale(${e.scale})`},attrs:{draggable:e.isDragging,src:e.imageUrl,alt:""}}),e.drawingBox.active?t("LabelBox",{attrs:{"b-width":e.drawingBox.width,"b-height":e.drawingBox.height,"b-top":e.drawingBox.top,"b-left":e.drawingBox.left,color:e.selectedTag.color}}):e._e(),e.boxes?t("div",e._l(e.boxes,(function(i,s){return t("vue-drag-resize-rotate",{key:i.id,ref:"marksRef",refInFor:!0,style:{"--color":i.tag.color,border:"1px "+i.tag.color+" solid",background:i.tag.color,opacity:e.isShowName?1:.7,display:e.shouldHide(i.tag)?"none":"block"},attrs:{active:i.active,title:i.tag&&i.tag.name,y:i.top,x:i.left,w:i.width,h:i.height,parent:!1,"enable-native-drag":!1,draggable:!e.isDragging,resizable:!e.isDragging,rotatable:!e.isDragging,r:i.r},on:{"update:active":function(t){return e.$set(i,"active",t)},resizing:function(t){e.boxResizing=!0},dragging:function(t){e.boxDragging=!0},dragstop:(t,s)=>e.onDragStop(i,t,s),resizestop:(t,s,o,a)=>e.onResizeStop(i,t,s,o,a),rotatestop:t=>e.onRotateStop(i,t)},nativeOn:{mouseenter:function(t){return e.mouseenter(s)}}},[e.isShowName||e.isDragging||!i.active?e._e():t("div",{staticStyle:{display:"flex"}},[t("el-button",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",height:"10px",width:"10px"},attrs:{size:"mini",icon:"el-icon-circle-close",circle:""},on:{click:function(t){return e.removeBox(i)}}})],1),e.isShowName?t("div",{staticClass:"show-name",style:{fontSize:i.height/2+"px"}},[t("div",{staticClass:"ellipsis"},[e._v(" "+e._s(i.tag.name)+" ")])]):e._e()])})),1):e._e()],1)]),e.isFullScreen?e._e():t("el-aside",{staticStyle:{"background-color":"rgb(238, 241, 246)"},attrs:{width:"350px"}},[t("SidePanel")],1)],1)],1)},n=[],r=(i(868),i(3568)),d=i.n(r),c=i(1760),g=i.n(c),h=i(8416),m=i(2236),u=i(2144),f=i.n(u);function p(e,t,i,s){return e=s<0?e+s:e,t=i<0?t+i:t,i=Math.abs(i),s=Math.abs(s),{top:e,left:t,width:i,height:s}}function b(e,t){const i=t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom;return!i}var v=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center","flex-direction":"column",padding:"30px 0px 30px 0px"}},[t("recycle-scroller",{ref:"scroller",staticClass:"virtual-list",staticStyle:{height:"80vh",width:"200px"},attrs:{prerender:20,buffer:10,"item-size":120,"key-field":"id",items:e.imgs},scopedSlots:e._u([{key:"default",fn:function({item:i}){return[t("div",{staticClass:"image-container",class:{img_selected:e.selectedImg&&i.id===e.selectedImg.id}},[t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[t("el-image",{key:i.id,ref:i.id,staticStyle:{width:"100px",height:"100px",padding:"8px"},attrs:{id:i.id,src:i.url,lazy:""},on:{contextmenu:function(e){return e.preventDefault(),(()=>{}).apply(null,arguments)},click:function(t){return e.chooseImg(i)}}})],1),i.marks&&i.marks.length>0?t("div",{staticClass:"image-dot"},[t("i",{staticClass:"el-icon-success",staticStyle:{color:"green",background:"white","border-radius":"50%"}})]):e._e()])]}}])}),t("el-dialog",{attrs:{title:"确认删除图片",visible:e.confirmDialogVisible},on:{"update:visible":function(t){e.confirmDialogVisible=t},close:function(t){e.confirmDialogVisible=!1}}},[t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticStyle:{"background-color":"red",color:"white","border-color":"red"},attrs:{type:"primary"},on:{click:e.delImg}},[e._v(" 删 除 ")]),t("el-button",{on:{click:function(t){e.confirmDialogVisible=!1}}},[e._v(" 取 消 ")])],1)])],1)},w=[],x={data(){return{loading:!1,confirmDialogVisible:!1,imgIdToDel:null}},computed:{...(0,h.ys)("images",["imgs"]),...(0,h.gV)("images",["selectedImg"]),noMore(){return this.imgs.length>0},disabled(){return this.loading||this.noMore}},watch:{async selectedImg(e,t){if(e&&t&&t.id!==e.id){const i=this.imgs.findIndex((t=>t.id===e.id)),s=this.imgs.findIndex((e=>e.id===t.id));if(i>=0){const t=this.$refs.scroller,o=t.$el.getBoundingClientRect(),a=this.$refs[e.id].$el.getBoundingClientRect();a.top>o.top&&a.bottom<o.bottom||(i>s?t.scrollToPosition(120*(i+1)-o.height):t.scrollToPosition(120*i))}}}},async mounted(){this.loading=!0,0===this.imgs.length&&(await this.loadImgsAsync(),await this.chooseNextImg()),this.loading=!1},methods:{...(0,h.sR)("images",["chooseImg","chooseNextImg","choosePrevImg"]),...(0,h.ae)("images",["loadImgsAsync"]),async delImg(){if(this.imgIdToDel){if(this.selectedImg&&this.selectedImg.id===this.imgIdToDel){const e=this.imgs.findIndex((e=>e.id===this.selectedImg.id)),t=e<this.imgs.length-1,i=e>0;if(t)this.chooseNextImg();else{if(!i)return this.$notify({title:"提示",message:"不能删除当前选中的图片",duration:1e3}),void(this.confirmDialogVisible=!1);this.choosePrevImg()}}this.confirmDialogVisible=!1}},async load(){this.loading=!0,await this.loadImgsAsync(),this.loading=!1}}},y=x,k=i(2528),I=(0,k.c)(y,v,w,!1,null,"051cb349",null),S=I.exports,D=function(){var e=this,t=e._self._c;return t("el-container",[t("el-col",{style:{padding:"10px"}},[t("el-row",{attrs:{type:"flex",align:"bottom"}},[t("el-col",{attrs:{span:6}},[t("div",{staticStyle:{"text-align":"left"}},[e._v("Labels")])]),t("el-col",{attrs:{span:6,offset:0}},[t("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(t){return e.showDialog(e.createForm.type)}}},[e._v(" add label ")])],1)],1),t("el-divider"),e._l(e.tags,(function(i){return t("div",{key:i.id},[i.isDel?e._e():t("div",{staticClass:"tag",class:{tag_selected:e.selectedTag&&i.id===e.selectedTag.id},on:{click:function(t){return e.chooseTag(i)}}},[t("div",{staticStyle:{display:"flex","flex-direction":"row","align-items":"center"}},[t("div",{staticClass:"box",style:{background:i.color}}),t("div",{staticClass:"ellipsis",attrs:{title:i.name}},[e._v(" "+e._s(i.name)+" ")])]),t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("div",[e._v("("+e._s(e.$store.getters["images/getTotalTagCount"](i.id))+")  ")]),t("el-popover",{ref:"popoverRef",refInFor:!0,attrs:{placement:"bottom",trigger:"hover"}},[t("el-button",{attrs:{slot:"reference",size:"mini",icon:"iconfont icon-shenglvehao"},on:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},slot:"reference"}),t("div",[t("el-tooltip",{attrs:{content:"hide",placement:"bottom"}},[t("el-button",{attrs:{size:"mini",icon:i.isHide?"iconfont icon-jurassic_loseeyes":"iconfont icon-jurassic_openeyes"},on:{click:function(t){return t.stopPropagation(),e.hideTag(i)}}})],1),t("el-tooltip",{attrs:{content:"edit",placement:"bottom"}},[t("el-button",{attrs:{size:"mini",icon:"iconfont icon-edit"},on:{click:function(t){return t.stopPropagation(),e.showDialog(e.changeForm.type,i)}}})],1),t("el-tooltip",{attrs:{content:"delete",placement:"bottom"}},[t("el-button",{attrs:{size:"mini",icon:"iconfont icon-delete"},on:{click:function(t){return t.stopPropagation(),e.beforeDeleteTag(i)}}})],1)],1)],1)],1)])])})),t("el-dialog",{attrs:{title:e.form.title,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){e.dialogVisible=!1}}},[t("el-form",{attrs:{model:e.form}},[t("el-form-item",{attrs:{label:"label name","label-width":e.formLabelWidth}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"pick color","label-width":e.formLabelWidth}},[t("el-row",{attrs:{type:"flex"}},[t("el-color-picker",{attrs:{size:"medium"},model:{value:e.form.color,callback:function(t){e.$set(e.form,"color",t)},expression:"form.color"}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(" cancel ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmDialog}},[e._v(" ok ")])],1)],1),t("el-dialog",{attrs:{title:"confirm delete label?",visible:e.confirmDialogVisible},on:{"update:visible":function(t){e.confirmDialogVisible=t},close:function(t){e.confirmDialogVisible=!1}}},[t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{staticStyle:{"background-color":"red",color:"white","border-color":"red"},attrs:{type:"primary"},on:{click:e.deleteTag}},[e._v(" delete ")]),t("el-button",{on:{click:function(t){e.confirmDialogVisible=!1}}},[e._v(" cancel ")])],1)])],2)],1)},T=[],_={name:"SidePanel",data(){return{tag:null,formLabelWidth:"120px",dialogVisible:!1,confirmDialogVisible:!1,form:{},createForm:{type:0,title:"add label",name:"",color:"#40DFFF"},changeForm:{type:1,title:"edit label"}}},computed:{...(0,h.ys)("tags",["tags"]),...(0,h.gV)("tags",["selectedTag","validTagCount"]),maxTagId(){if(!this.tags||0===this.tags.length)return 0;let e=0;return this.tags.forEach((t=>{t.id>e&&(e=t.id)})),e+1}},watch:{},methods:{...(0,h.sR)("tags",["addTag","delTag","chooseTag","updateTag"]),...(0,h.sR)("images",["updateMarksForAllImgs"]),beforeDeleteTag(e){this.tag=e,this.confirmDialogVisible=!0},hideTag(e){e.isHide?delete e.isHide:e.isHide=!0,this.updateTag(e)},async deleteTag(){this.tag&&(this.delTag(this.tag),this.updateMarksForAllImgs({tag:this.tag,isDel:!0})),this.tag=null,this.confirmDialogVisible=!1},confirmDialog(){this.dialogVisible=!1;const{name:e,color:t,id:i,type:s}=this.form;if(0===s)this.addTag({name:e,color:t,id:this.maxTagId}),this.tags&&1===this.validTagCount&&this.chooseTag(this.tags.find((e=>!e.isDel)));else{const s={name:e,color:t,id:i};this.updateTag(s),this.updateMarksForAllImgs({tag:s,isDel:!1})}},showDialog(e,t){this.form=0===e?{...this.createForm}:{...this.changeForm,...t},this.dialogVisible=!0}}},H=_,C=(0,k.c)(H,D,T,!1,null,"c8ff37de",null),z=C.exports,F=function(){var e=this,t=e._self._c;return t("div",{staticClass:"box-wrapper"},[t("div",{staticClass:"box",style:{borderColor:e.color,top:e.coords.top+"px",left:e.coords.left+"px",width:e.coords.width-2+"px",height:e.coords.height-2+"px"}})])},W=[],E={name:"LabelBox",props:{bTop:{type:Number,default:0},bLeft:{type:Number,default:0},bWidth:{type:Number,default:0},bHeight:{type:Number,default:0},color:{type:String,default:"#40DFFF"}},data(){return{}},computed:{coords(){const{bTop:e,bLeft:t,bWidth:i,bHeight:s}=this;return p(e,t,i,s)}}},R=E,M=(0,k.c)(R,F,W,!1,null,"23bf7f56",null),B=M.exports,$={name:"App",components:{LabelBox:B,SidePanel:z,VueDragResizeRotate:g(),ImageSlider:S},data:function(){return{isShowName:!1,isFullScreen:!1,resizedScale:1,defaultWidth:1024,defaultHeight:768,wrapperWidth:1024,wrapperHeight:768,drawingBox:{},boxes:[],boxDragging:!1,boxResizing:!1,MARK:2,DRAG:1,mode:2,imageUrl:"",imgW:0,imgH:0,deg:0,top:0,left:0,scale:1,mousewheelevt:null,showGuideline:!1,guidelineX:0,guidelineY:0,guideLineColor:"#409EFF"}},computed:{...(0,h.ys)("tags",["tags"]),...(0,h.ys)("images",["imgs"]),...(0,h.gV)("tags",["selectedTag","validTagCount","validTags"]),...(0,h.gV)("images",["selectedImg","markedImgs"]),isDragging(){return 1===this.mode},currentTags(){const e={},t=this.tags.filter((e=>!e.isDel));return t.forEach(((t,i)=>{this.selectedImg&&this.selectedImg.marks&&this.selectedImg.marks.forEach((s=>{t.id===s.tag.id&&(e[i]||(e[i]=0),e[i]+=1)}))})),e}},watch:{selectedTag(e){this.guideLineColor=e.color},async selectedImg(e,t){if(e){if(!t||e.id!==t.id){await this.initImage(),await this.orientImageAfterResizeMaskbox(),this.initMarks();const e=this.wrapperWidth/this.imgW,t=this.wrapperHeight/this.imgH;this.resizedScale=e<t?e:t,this.scaleTo(this.resizedScale)}this.initMarks()}}},mounted(){this.setMode(this.MARK),this.mousewheelevt=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel",document.addEventListener("keydown",this.handleKeydown),document.addEventListener("keyup",this.handleKeyup),document.addEventListener("wheel",this.wheelHandle,{passive:!1}),document.addEventListener("fullscreenchange",this.handleFullScreenChange),window.addEventListener("resize",this.handleResize),this.handleResize()},beforeUnmount(){document.removeEventListener("keydown",this.handleKeydown),document.removeEventListener("keyup",this.handleKeyup),document.removeEventListener("wheel",this.wheelHandle,{passive:!1}),document.removeEventListener("fullscreenchange",this.handleFullScreenChange),window.removeEventListener("resize",this.handleResize)},methods:{...(0,h.sR)("tags",["addTag","delTag"]),...(0,h.sR)("images",["saveImgWH","delImgMark","addImgMark","chooseNextImg","choosePrevImg"]),async handleResize(){console.log("resize triggered"),this.wrapperWidth=window.innerWidth-100-600,this.wrapperHeight=window.innerHeight-60-100,await this.orientImageAfterResizeMaskbox();let e=this.wrapperWidth/this.imgW,t=this.wrapperHeight/this.imgH;this.resizedScale=e<t?e:t,this.scaleTo(this.resizedScale),this.isFullScreen=!1},async requestFullscreen(){document.documentElement.requestFullscreen&&await document.documentElement.requestFullscreen()},handleScreen(){this.isFullScreen?this.handleSmallScreen():this.handleFullScreen()},handleSmallScreen(){document.fullscreenElement&&this.exitFullscreen(),this.handleResize()},handleFullScreenChange(){document.fullscreenElement||this.handleResize()},exitFullscreen(){document.exitFullscreen&&document.exitFullscreen()},async handle1024x768(){this.wrapperWidth=this.defaultWidth,this.wrapperHeight=this.defaultHeight,await this.orientImageAfterResizeMaskbox(),this.scaleTo(1),this.isFullScreen=!1},async handleFullScreen(){await this.requestFullscreen();const e=this;setTimeout((async()=>{const{parentContainer:t}=e.$refs;e.wrapperWidth=t.$el.clientWidth-2,e.wrapperHeight=t.$el.clientHeight-2,await e.orientImageAfterResizeMaskbox();const i=e.wrapperWidth/e.imgW,s=e.wrapperHeight/e.imgH;e.resizedScale=i<s?i:s,e.scaleTo(e.resizedScale),e.isFullScreen=!0}),500)},drawGuideline(e){this.guidelineX=e.pageX,this.guidelineY=e.pageY},async handleKeyup(e){"Control"===e.key&&this.mode!==this.MARK?this.toggleMode():"ArrowLeft"===e.key&&this.selectedImg?this.choosePrevImg():"ArrowRight"===e.key&&this.selectedImg&&this.chooseNextImg()},async handleKeydown(e){const t=this.boxes.find((e=>e.active));if("Control"===e.key&&this.mode!==this.DRAG)this.toggleMode();else if("Space"===e.code&&this.selectedImg);else if("Delete"===e.key&&t)this.removeBox(t);else if(/^[1-9]$/.test(e.key)&&t){const i=this.tags.filter((e=>!e.isDel))[parseInt(e.key)-1];i&&(t.tag=i)}},shouldHide(e){const t=this.tags.find((t=>t.id===e.id));return!0===t.isHide},wheelHandle(e){if(e.preventDefault(),!e.ctrlKey)return;const t=e||window.event,i=t.detail?-120*t.detail:t.wheelDelta;let s=.25;i/2e3<0&&(s=-.25),this.imgScaleHandle(s)},getCursorTopLeft(e){const t=this.$refs.maskBox.getBoundingClientRect(),i=t.x,s=t.y;return{left:e.pageX-i,top:e.pageY-s}},generateDataSet(){let e=[];e=this.imgs.filter((e=>e.marks&&e.marks.length>0)),e.forEach((e=>{const{realWidth:t,realHeight:i,width:s}=e,o=t/s;e.marks.forEach((e=>{const s=this.getBBox({realWidth:t,realHeight:i,mark:e,ratio:o});s&&(e.bbox=s)}))})),this.getCocoFormat(e)},getCocoFormat(e){let t={info:"info",licenses:"licenses",images:[]};const i=e.filter((e=>(e.marks=e.marks.filter((e=>e.bbox)),e.marks.length>0)));let s=[];const o=[];i.forEach(((e,i)=>{const{name:a,realWidth:l,realHeight:n}=e,r=i;t.images.push({file_name:a,width:parseInt(l),height:parseInt(n),id:r}),e.marks.forEach((e=>{const{tag:t}=e;this.shouldHide(t)||(s.push({id:t.id,name:t.name}),o.push({segmentation:null,area:1.1,iscrowd:0,meta:{points:[]},shape:"rect",category_id:t.id,image_id:r,bbox:e.bbox.map((e=>parseInt(e)))}))}))})),s=d().uniqBy(s,"id"),o.forEach(((e,t)=>{e.id=t})),t={...t,categories:s,annotations:o},f()(JSON.stringify(t,null,2),"coco_info.json")},getBBox({realWidth:e,realHeight:t,mark:i,ratio:s}){const o={x:e/2,y:t/2},a=d().clone(i),l=["diffX","diffY","origWidth","origHeight"];l.forEach((e=>{a[e]*=s})),a.width=a.origWidth,a.height=a.origHeight;const n=o.x+a.diffX,r=o.y+a.diffY,{width:c}=a,{height:g}=a,h={top:0,bottom:t,left:0,right:e},m={top:r,bottom:r+g,left:n,right:n+c},u=b(h,m);if(!u)return;let f,p,v,w;return f=n,p=r,v=c,w=g,n<0&&(v+=n,f=0),r<0&&(w+=r,p=0),n+c>e&&(v-=n+c-e),r+g>t&&(w-=r+g-t),[f,p,v,w]},mouseenter(e){const{marksRef:t}=this.$refs;if(!t||this.boxDragging||this.boxResizing)return;const i=t[e];i.active||["mousedown","mouseup"].forEach((e=>{i.$el.dispatchEvent(new MouseEvent(e))}))},getOrigin(){const{img:e}=this.$refs,t=parseFloat(e.style.top),i=parseFloat(e.style.left),s=t+e.height/2,o=i+e.width/2;return{x:o,y:s}},scaleTo(e){if(this.scale=e,!this.boxes)return;this.boxes.forEach((e=>{e.width=this.scale*e.origWidth,e.height=this.scale*e.origHeight}));const{x:t,y:i}=this.getOrigin();this.boxes.forEach((e=>{e.left=t+this.scale*e.diffX,e.top=i+this.scale*e.diffY}))},imgScaleHandle(e){let t=1,i=2;if(this.isFullScreen&&(t=this.resizedScale,i=2*this.resizedScale),this.scale<=t&&e<0)return;if(this.scale>=i&&e>0)return;if(this.scale+=e,!this.boxes)return;this.boxes.forEach((e=>{e.width=this.scale*e.origWidth,e.height=this.scale*e.origHeight}));const{x:s,y:o}=this.getOrigin();this.boxes.forEach((e=>{e.left=s+this.scale*e.diffX,e.top=o+this.scale*e.diffY}))},onDragStop(e,t,i){e.left=t,e.top=i;const{diffX:s,diffY:o}=this.getDiff(e);e.diffX=s,e.diffY=o,this.boxDragging=!1},onResizeStop(e,t,i,s,o){e.left=t,e.top=i,e.width=s,e.height=o,e.origWidth=s/this.scale,e.origHeight=o/this.scale;const{diffX:a,diffY:l}=this.getDiff(e);e.diffX=a,e.diffY=l,this.boxResizing=!1},onRotateStop(e,t){e.r=t},toggleGuideLine(){this.showGuideline=!this.showGuideline},toggleMode(){this.mode===this.DRAG?this.setMode(this.MARK):this.setMode(this.DRAG)},setMode(e){this.mode=e;const{maskBox:t}=this.$refs;e===this.DRAG?(t.onmouseup=null,t.onmousemove=null,t.onmousedown=this.onMouseDownDrag):(t.onmousedown=this.startDrawingBox,t.onmousemove=this.changeBox,t.onmouseup=this.stopDrawingBox)},getImgSize(e){return new Promise((t=>{const i=new Image;i.src=e,i.onload=()=>{t({width:i.width,height:i.height})}}))},initMarks(){this.selectedImg.marks||(this.selectedImg.marks=[]),this.boxes=this.selectedImg.marks,this.imgScaleHandle(0)},async initImage(){if(!this.selectedImg||!this.selectedImg.url)return;this.scale=1,this.imageUrl=this.selectedImg.url;const{width:e,height:t}=await this.getImgSize(this.imageUrl),i=e,s=t,o=i/s,a=s/i,l=this.defaultWidth,n=this.defaultHeight;if(i>=s){this.imgH=a*l;const e=this.imgH;e>n?(this.imgH=n,this.imgW=o*n):this.imgW=l,this.top=(n-this.imgH)/2,this.left=(l-this.imgW)/2}else this.imgW=n/s*i,this.imgH=n,this.top=0,this.left=(l-this.imgW)/2;this.saveImgWH({id:this.selectedImg.id,realWidth:i,realHeight:s,width:this.imgW,height:this.imgH})},async orientImageAfterResizeMaskbox(){if(!this.selectedImg||!this.selectedImg.url)return;const{width:e,height:t}=await this.getImgSize(this.imageUrl),i=e,s=t,o=i/s,a=s/i,{maskBox:l}=this.$refs,n=l.clientWidth,r=l.clientHeight;let d,c,g,h;if(i>=s){d=a*n;const e=d;e>r?(d=r,c=o*r):c=n,g=(r-d)/2,h=(n-c)/2}else c=r/s*i,d=r,g=0,h=(n-c)/2;this.top=g+(d-this.imgH)/2,this.left=h+(c-this.imgW)/2},handleRef(){const{marksRef:e}=this.$refs;e&&e.forEach((e=>{const{width:t,height:i,transform:s}=e.style;console.log(`width ${t} height ${i} transform ${s}`)}))},removeBox(e){this.delImgMark(e.id)},onMouseDownDrag(e){const t=this;e.preventDefault();const{maskBox:i}=this.$refs;i.onmousemove=function(e){const i=e||window.event;i.preventDefault(),t.left+=i.movementX,t.top+=i.movementY,t.boxes&&t.boxes.forEach((e=>{e.left+=i.movementX,e.top+=i.movementY}))},i.onmouseup=function(){i.onmousemove=null,i.onmouseup=null}},startDrawingBox(e){if(!this.selectedImg)return;const t=this.boxes&&this.boxes.filter((e=>e.active));if(t&&t.length>0)return;if(!this.selectedTag)return void this.$notify({title:"tip",message:this.validTagCount>0?"please choose label":"please add label",duration:1e3});const{top:i,left:s}=this.getCursorTopLeft(e);this.drawingBox={top:i,left:s,active:!0}},changeBox(e){const{top:t,left:i}=this.getCursorTopLeft(e);this.drawingBox.active&&(this.drawingBox={...this.drawingBox,width:i-this.drawingBox.left,height:t-this.drawingBox.top})},getDiff(e){const{x:t,y:i}=this.getOrigin(),s=(e.left-t)/this.scale,o=(e.top-i)/this.scale;return{diffX:s,diffY:o}},stopDrawingBox(){if(this.drawingBox.active){const{top:e,left:t,width:i,height:s}=this.drawingBox;let o=p(e,t,i,s);o.origWidth=o.width/this.scale,o.origHeight=o.height/this.scale,o={...o,...this.getDiff(o)},(o.width>5||o.height>5)&&this.addImgMark({...o,id:m.u.v1(),tag:this.selectedTag,r:0}),this.drawingBox={}}}}},L=$,A=(0,k.c)(L,l,n,!1,null,"194023c6",null),V=A.exports,O={namespaced:!0,state:()=>({tags:[]}),mutations:{updateTag(e,t){e.tags.forEach(((i,o)=>{i.id===t.id&&s["default"].set(e.tags,o,{...i,...t})}))},addTag(e,t){e.tags.push(t)},delTag(e,t){e.tags.forEach(((i,o)=>{i.id===t.id&&(i.isDel=!0,s["default"].set(e.tags,o,i))}))},chooseTag(e,t){e.tags.forEach(((i,o)=>{i.id===t.id?s["default"].set(e.tags,o,{...i,selected:!0}):i.selected&&(delete i.selected,s["default"].set(e.tags,o,i))}))},getTags(e,t){e.tags=[],e.tags.push(...t)}},getters:{selectedTag:e=>e.tags.find((e=>e.selected&&!e.isDel)),validTagCount:e=>e.tags.filter((e=>!e.isDel)).length,validTags:e=>e.tags.filter((e=>!e.isDel))}},P=i(2774),N=i(7392),j=i.n(N);const X=P.c.create({withCredentials:!1,timeout:3e3,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"}});X.interceptors.request.use((e=>(e.data=j().stringify(e.data),e))),X.interceptors.response.use((e=>e),(e=>e));var Y=X;const G={get(e,t,i){const s={method:"GET",url:e,params:t||{},headers:i||{}};return Y(s)},post(e,t,i){const s={method:"POST",url:e,data:t||{},headers:i||{}};return Y(s)}};var K=G;function q(){return K.get("/images")}var U={namespaced:!0,state:()=>({imgs:[]}),mutations:{saveImgWH(e,{id:t,realWidth:i,realHeight:s,width:o,height:a}){e.imgs.forEach((e=>{e.id===t&&(e.realWidth=i,e.realHeight=s,e.width=o,e.height=a)}))},addImgMark(e,t){const i=e.imgs.findIndex((e=>e.selected));if(i<0)return;const o=e.imgs[i];o.marks&&0!==o.marks.length||(o.marks=[]),o.marks.push(t),s["default"].set(e.imgs,i,o)},getImgMarks(e,{marks:t,id:i}){const o=e.imgs.find((e=>e.id===i)),a=e.imgs.findIndex((e=>e.id===i));o.marks&&o.marks.length>0||t&&t.length>0&&(o.marks||(o.marks=[]),o.marks.push(...t),s["default"].set(e.imgs,a,o))},delImgMark(e,t){const i=e.imgs.find((e=>e.selected)),o=e.imgs.findIndex((e=>e.selected)),{marks:a}=i;if(a){for(let e=a.length-1;e>=0;e--)a[e].id===t&&a.splice(e,1);s["default"].set(e.imgs,o,i)}},delImg(e,t){for(let i=e.imgs.length-1;i>=0;i--)if(e.imgs[i].id===t)return void e.imgs.splice(i,1)},loadImgs(e,t){let i=window.location.hostname+(window.location.port?":"+window.location.port:"");i=window.location.protocol+"//"+i,t.forEach((t=>{e.imgs.push({id:t,url:`${i}/images/`+t,name:t})}))},chooseImg(e,t){e.imgs.forEach(((i,o)=>{i.id===t.id?(i.selected=!0,s["default"].set(e.imgs,o,i)):i.selected&&(delete i.selected,s["default"].set(e.imgs,o,i))}))},choosePrevImg(e){const t=e.imgs.findIndex((e=>e.selected));t>0&&(delete e.imgs[t].selected,e.imgs[t-1].selected=!0),s["default"].set(e.imgs,t,e.imgs[t])},chooseNextImg(e){const t=e.imgs.findIndex((e=>e.selected));-1==t?(e.imgs[0].selected=!0,s["default"].set(e.imgs,0,e.imgs[0])):t<e.imgs.length-1&&(delete e.imgs[t].selected,e.imgs[t+1].selected=!0,s["default"].set(e.imgs,t,e.imgs[t]))},updateMarksForAllImgs(e,{tag:t,isDel:i}){e.imgs.forEach((e=>{const{marks:o}=e;if(o)if(i)for(let i=o.length-1;i>=0;i--)o[i].tag.id===t.id&&o.splice(i,1);else o.forEach(((e,i)=>{if(e.tag.id===t.id){const{name:a,color:l}=t;e.tag.name=a,e.tag.color=l,s["default"].set(o,i,e)}}))}))}},actions:{async loadImgsAsync({commit:e}){let t=await q();200===t.status&&e("loadImgs",t.data)}},getters:{selectedImg:e=>e.imgs.find((e=>e.selected)),markedImgs:e=>e.imgs.filter((e=>e.marks&&e.marks.length>0)).length,getTotalTagCount:e=>t=>{let i=0;return e.imgs.forEach((e=>{e.marks&&(i+=e.marks.filter((e=>e.tag&&e.tag.id===t)).length)})),i}}};s["default"].use(h.cp);var J=new h.cp.Store({modules:{tags:O,images:U}}),Q=i(7536),Z=i(1360);s["default"].use(a(),{locale:Q.c}),s["default"].use(Z.cp),s["default"].config.productionTip=!1,new s["default"]({store:J,render:e=>e(V)}).$mount("#app")},6204:function(){}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={id:s,loaded:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=e,function(){i.amdO={}}(),function(){var e=[];i.O=function(t,s,o,a){if(!s){var l=1/0;for(c=0;c<e.length;c++){s=e[c][0],o=e[c][1],a=e[c][2];for(var n=!0,r=0;r<s.length;r++)(!1&a||l>=a)&&Object.keys(i.O).every((function(e){return i.O[e](s[r])}))?s.splice(r--,1):(n=!1,a<l&&(l=a));if(n){e.splice(c--,1);var d=o();void 0!==d&&(t=d)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[s,o,a]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,a,l=s[0],n=s[1],r=s[2],d=0;if(l.some((function(t){return 0!==e[t]}))){for(o in n)i.o(n,o)&&(i.m[o]=n[o]);if(r)var c=r(i)}for(t&&t(s);d<l.length;d++)a=l[d],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(c)},s=self["webpackChunklabel_demo"]=self["webpackChunklabel_demo"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=i.O(void 0,[999],(function(){return i(7044)}));s=i.O(s)})();